<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>单节点 ElasticSearch 及 Kibana 安装说明 | Your awesome title</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="单节点 ElasticSearch 及 Kibana 安装说明" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<link rel="canonical" href="http://localhost:4000/es-kibana-single-node-install" />
<meta property="og:url" content="http://localhost:4000/es-kibana-single-node-install" />
<meta property="og:site_name" content="Your awesome title" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="单节点 ElasticSearch 及 Kibana 安装说明" />
<script type="application/ld+json">
{"url":"http://localhost:4000/es-kibana-single-node-install","headline":"单节点 ElasticSearch 及 Kibana 安装说明","@type":"WebPage","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Your awesome title" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Your awesome title</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/es-kibana-single-node-install">单节点 ElasticSearch 及 Kibana 安装说明</a><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">单节点 ElasticSearch 及 Kibana 安装说明</h1>
  </header>

  <div class="post-content">
    <h1 id="单节点-elasticsearch-及-kibana-安装说明">单节点 ElasticSearch 及 Kibana 安装说明</h1>
<h2 id="概述">概述</h2>
<p>    为了支持新功能，我们新增了ES节点。 可以根据数据情况和状态，配置ES为单节点或集群; 开启Xpack, 启用权限认证(需要安装Kibana)。 
    官方文档 Set up Elasticsearch 有各个 OS 的安装指导，<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.3/install-elasticsearch.html">Installing Elasticsearch</a> 页面中提供了多种安装包对应的指导链接，可以参考。本文档为在单节点linux服务器上安装ES及Kibana的说明文档。</p>

<h2 id="安装es">安装ES</h2>
<ol>
  <li>首先确认环境中有JDK。 Elasticsearch 7.x 包里自包含了 OpenJDK11 的包，如果需要用自己的版本，参考<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup.html">官方文档</a>设置 JAVA_HOME 环境变量。</li>
  <li>创建ES专用用户，因为无法使用<em>root</em>用户启动：
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> useradd elasticsearch
</code></pre></div>    </div>
    <p>创建ES程序目录，并给<em>elasticsearch</em>用户赋权限：</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /home
mkdir /es
chown -R elasticsearch:elasticsearch /home/es/
</code></pre></div>    </div>
  </li>
  <li>
    <p>上传压缩包内的<strong>elasticsearch-7.14.0-linux-x86_64.tar.gz</strong>，也可去官网下载或使用其他方式下载。
<a href="https://www.elastic.co/cn/downloads/elasticsearch">官网下载地址</a>,   <a href="http://dl.elasticsearch.cn/elasticsearch/">国内镜像下载地址</a></p>
  </li>
  <li>解压
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -zxvf elasticsearch-7.14.0-linux-x86_64.tar.gz
</code></pre></div>    </div>
  </li>
  <li>修改配置文件，进入解压后的目录
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd elasticsearch-7.14.0/config
</code></pre></div>    </div>
    <p>首先备份配置文件<strong>elasticsearch.yml</strong>，而后修改</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp elasticsearch.yml elasticsearch.yml.bak 
vim elasticsearch.yml
------------------------------
network.host: ${该服务器的ip}
http.port: 9200
discovery.seed_hosts: ["${该服务器的ip}"]
discovery.type: single-node # 单节点模式
------------------------------
</code></pre></div>    </div>
  </li>
  <li>把9200和9300端口开放，或者关闭防火墙</li>
  <li>根据配置文件，创建data目录存储es数据
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir data
</code></pre></div>    </div>
  </li>
  <li>给ES用户所有ES相关的权限；切换到<em>elasticsearch</em>用户；在bin目录下启动ES
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> chown -R elasticsearch:elasticsearch ./*
 su – elasticsearch
 cd /home/es/elasticsearch-7.14.0/bin
 ./elasticsearch &amp;   
</code></pre></div>    </div>
    <p>启动后可能会出现报错：</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> trying to update state on non-existing task geoip-downloader
 [2021-08-11T15:33:57,318][ERROR][o.e.i.g.GeoIpDownloader ] [18789989a729] error updating geoip database [GeoLite2-Country.mmdb]
</code></pre></div>    </div>

    <p>该报错可以忽略；若想解决请看<a href="#附录">附录 1.解决ES启动报错问题</a></p>
  </li>
  <li>验证启动情况，在本机执行
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://${ip}:9200/
</code></pre></div>    </div>
    <p>得到返回结果如:</p>
    <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"localhost.localdomain"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cluster_name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"oss-es"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cluster_uuid"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"HKCnF4l_TOSW8-mznxM5eg"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"number"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"7.14.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_flavor"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"default"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_type"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"tar"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_hash"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dd5a0a2acaa2045ff9624f3729fc8a6f40835aa1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_date"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2021-07-29T20:49:32.864135063Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"build_snapshot"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nl">"lucene_version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"8.9.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"minimum_wire_compatibility_version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"6.8.0"</span><span class="p">,</span><span class="w">  
    </span><span class="nl">"minimum_index_compatibility_version"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"6.0.0-beta1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"tagline"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"You Know, for Search"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>    </div>
    <p>即为成功！
 再尝试通过浏览器访问http://${ip}:9200/有相同的响应成功结果。  若无法访问，则检查防火墙。</p>
  </li>
</ol>

<h2 id="安装kibana">安装Kibana</h2>
<ol>
  <li>安装步骤可参考<a href="https://www.elastic.co/guide/en/kibana/current/targz.html">官方网站</a>；或按以下步骤执行</li>
  <li>使用<em>root</em>用户，上传压缩包内的<strong>kibana-7.14.0-linux-x86_64.tar.gz</strong>并解压。
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> tar -zxvf kibana-7.14.0-linux-x86_64.tar.gz
</code></pre></div>    </div>
  </li>
  <li>进入目录备份配置文件<strong>kibana.yml</strong>，而后修改
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cd kibana-7.14.0-linux-x86_64/config/
 cp kibana.yml kibana.yml.bak
 vim kibana.yml 
 ------------------------------
 server.port: 5601
 server.host: "${该服务器的ip}"
 elasticsearch.hosts: ["http://${ES服务所在IP}:9200"]
 elasticsearch.username: "kibana_system"
 ------------------------------
</code></pre></div>    </div>
  </li>
  <li>进入/bin 目录启动
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cd ../bin
./kibana
</code></pre></div>    </div>
    <p>界面会打印日志，最后出现如下所示内容，即为成功！</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Kibana is now available
</code></pre></div>    </div>
    <p>可通过浏览器访问 http://ip:5601</p>
  </li>
</ol>

<h2 id="配置权限使用用户名和密码身份验证运行本地集群">配置权限(使用用户名和密码身份验证运行本地集群)</h2>
<ol>
  <li>可以参考官网<a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.14/security-minimal-setup.html">最低安全性设置</a></li>
  <li>停止 Kibana 和 Elasticsearch（如果它们正在运行）</li>
  <li>将 xpack.security.enabled 设置添加到<strong>$ES_PATH_CONF/elasticsearch.yml</strong>文件并将值设置为true
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cd /home/es/elasticsearch-7.14.0/config
 vim elasticsearch.yml
-----添加以下信息-------
xpack.security.enabled:true
----------------------
</code></pre></div>    </div>
    <p><em>tips:该$ES_PATH_CONF变量是 Elasticsearch 配置文件的路径。如果您使用存档分发版（zip或tar.gz）安装了 Elasticsearch ，则该变量默认为$ES_HOME/config. 如果您使用软件包发行版（Debian 或 RPM），则该变量默认为/etc/elasticsearch.</em></p>
  </li>
  <li>启动ES，等待启动成功
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ../bin
./elasticsearch
</code></pre></div>    </div>
  </li>
  <li>打开另一个终端窗口，进入ES目录，执行命令启用配置密码工具
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./bin/elasticsearch-setup-passwords interactive
</code></pre></div>    </div>
    <p>执行后根据命令行提示配置密码</p>
  </li>
  <li>配置 Kibana 以使用密码连接到 Elasticsearch ，创建 Kibana 密钥库并添加安全设置：
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> cd kibana-7.14.0-linux-x86_64/
  ./bin/kibana-keystore create
  ./bin/kibana-keystore add elasticsearch.password
</code></pre></div>    </div>
    <p>出现提示时，输入<em>kibana_system</em>用户的密码。</p>
  </li>
  <li>重启 Kibana,并在浏览器 “http://${kibanaIp}:5601” 以<em>elastic</em>用户身份登录 Kibana 。
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> ./bin/kibana
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="附录">附录</h2>
<ol>
  <li>解决ES启动报错问题
    <ol>
      <li>参考 <a href="https://discuss.elastic.co/t/how-to-disable-geoip-usage-in-7-14-0/281076">How to disable geoip usage in 7.14.0</a>
方案：使用 cluster settings API  而不是 elasticsearch.yml; 即安装好Kibana后，执行
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT _cluster/settings
{
 "persistent": {
    "ingest.geoip.downloader.enabled": false
 }
}
</code></pre></div>        </div>
      </li>
    </ol>
  </li>
</ol>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Your awesome title</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Your awesome title</li><li><a class="u-email" href="mailto:your-email@example.com">your-email@example.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/jekyll"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">jekyll</span></a></li><li><a href="https://www.twitter.com/jekyllrb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">jekyllrb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
